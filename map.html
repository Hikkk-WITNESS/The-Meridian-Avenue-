<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
@import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

:root {
    --term-bg: #0a0a0a;
    --term-border: #2a2a2a;
    --term-text: #a8a8a8;
    
    --color-upper: #c59d5f;      
    --color-lower: #a31621;      
    --color-meridian: #888888;   
    --color-neutral: #5a8fb4;    
    --color-park: #4a7a4a;     
    --color-industrial: #6b4423; 
    
    --color-highlight: #d4a017;  
    --color-danger: #a31621;
    --color-warn: #d68100;
}

* {
    box-sizing: border-box;
    -webkit-user-select: none;
    user-select: none;
}

body {
    margin: 0;
    /* background: #000;  移除 body 背景，避免影响小剧场 */
    display: flex;
    justify-content: center;
    align-items: center;
    /* min-height: 100vh; 移除高度限制，适应嵌入环境 */
    font-family: 'Share Tech Mono', monospace;
    overflow: hidden;
    padding: 10px;
}

.map-terminal {
    background: var(--term-bg);
    border: 2px solid var(--term-border);
    padding: 8px;
    color: var(--term-text);
    position: relative;
    box-shadow: 0 0 30px rgba(0, 0, 0, 0.9), inset 0 0 20px rgba(0,0,0,0.8);
    width: 100%;
    max-width: 600px;
    border-radius: 6px;
    background-image: url('https://www.transparenttextures.com/patterns/stardust.png');
}

.map-terminal::after {
    content: "";
    display: block;
    position: absolute;
    top: 0; left: 0; bottom: 0; right: 0;
    background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
          linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
    z-index: 200;
    background-size: 100% 2px, 3px 100%;
    pointer-events: none;
}

.ticker-header {
    border-bottom: 1px solid var(--term-border);
    padding: 12px 0;
    margin-bottom: 8px;
    background: rgba(255,255,255,0.02);
    position: relative;
    z-index: 100;
    overflow: hidden;
    height: 45px;
}

.ticker-wrapper {
    display: inline-block;
    white-space: nowrap;
    padding-left: 100%;
    animation: scroll 80s linear infinite;
}

.ticker-item {
    display: inline-block;
    padding: 0 50px;
    font-size: 12px;
    letter-spacing: 1.2px;
    color: #666;
}

.ticker-item.slogan { color: var(--color-highlight); }
.ticker-item.ad { color: var(--color-warn); }
.ticker-item.warning { color: var(--color-danger); }
.ticker-item.news { color: #5a8fb4; }
.ticker-item.celebrity { color: #b45a8f; }

@keyframes scroll {
    from { transform: translateX(0); }
    to { transform: translateX(-100%); }
}

.map-container {
    position: relative;
    width: 100%;
    aspect-ratio: 1 / 1.2;
    background: #050505;
    border: 1px solid #222;
    overflow: hidden;
    box-shadow: inset 0 0 15px #000;
}

.city-canvas {
    width: 100%;
    height: 100%;
    position: relative;
}

.grid-layer {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none;
    z-index: 1;
}

.grid-line {
    position: absolute;
    background: rgba(255, 255, 255, 0.12);
    pointer-events: none;
}

.meridian-line {
    position: absolute;
    left: 0; right: 0; top: 50%;
    height: 4px;
    z-index: 50;
    cursor: pointer;
    transform: translateY(-50%);
    transition: all 0.3s;
}
.meridian-line:hover {
    transform: translateY(-50%) scaleY(1.5);
}
.meridian-line-visual {
    position: absolute;
    left: 0; right: 0; top: 50%;
    transform: translateY(-50%);
    height: 2px;
    background: linear-gradient(to right, transparent 0%, var(--color-meridian) 10%, var(--color-meridian) 90%, transparent 100%);
    box-shadow: 0 0 15px var(--color-meridian), inset 0 0 5px rgba(255,255,255,0.3);
    animation: pulse 3s infinite;
    pointer-events: none;
}
.meridian-line-visual::before {
    content: "MERIDIAN AVENUE";
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    font-size: 8px; color: var(--color-meridian);
    letter-spacing: 2px; white-space: nowrap;
    text-shadow: 0 0 5px var(--color-meridian);
    background: rgba(0,0,0,0.8);
    padding: 2px 6px;
    pointer-events: none;
}

@keyframes pulse {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
}

.building-block {
    position: absolute;
    border: 1px solid;
    cursor: pointer;
    transition: all 0.3s;
    backdrop-filter: blur(2px);
}

/* 固定基礎層級：無名區塊(20) > 已命名區塊(15) */
.building-block.named {
    z-index: 15;
}

.building-block.unnamed {
    z-index: 20;
    pointer-events: none;
}

.building-block.named:hover { 
    z-index: 25; 
    transform: scale(1.05); 
}

/* 活躍狀態提升至最高層 */
.building-block.named.active { 
    border-width: 2px; 
    z-index: 30 !important; 
    transform: scale(1.08); 
    box-shadow: 0 0 15px rgba(255,255,255,0.2);
}

/* 進入詳情模式時，非活躍區塊變暗 */
.map-container.focus-mode .building-block:not(.active) { 
    opacity: 0.5; 
    border-color: rgba(255,255,255,0.2);
    filter: grayscale(30%);
}

.map-container.focus-mode .building-block.active {
    opacity: 1;
    filter: none;
}

.building-block.upper { 
    background: linear-gradient(135deg, rgba(197, 157, 95, 0.15), rgba(197, 157, 95, 0.05)); 
    border-color: var(--color-upper); 
}

.building-block.upper.active { 
    background: var(--color-upper); 
}

.building-block.lower { 
    background: linear-gradient(135deg, rgba(163, 22, 33, 0.15), rgba(163, 22, 33, 0.05)); 
    border-color: var(--color-lower); 
}

.building-block.lower.active { 
    background: var(--color-lower); 
}

/* 
   === 公園樣式回滾 ===
   恢復為高不透明度 (0.85)，點擊後變白
*/

.building-block.park { 
    background: linear-gradient(135deg, rgba(58, 95, 58, 0.50), rgba(58, 95, 58, 0.6)); 
    border: none; 
    filter: drop-shadow(0 0 1px #8fbc8f) drop-shadow(0 0 0.5px #8fbc8f);
}
.building-block.park:hover {
    filter: drop-shadow(0 0 2px #fff);
}
.building-block.park.active { 
    background: var(--color-park); 
    filter: drop-shadow(0 0 3px #fff);
}

.building-block.industrial { 
    background: linear-gradient(135deg, rgba(107, 68, 35, 0.2), rgba(107, 68, 35, 0.05)); 
    border-color: var(--color-industrial); 
}

.building-block.industrial.active { 
    background: var(--color-industrial); 
}

.building-label {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    font-size: 7px; font-weight: bold;
    text-align: center; pointer-events: none;
    text-shadow: 0 0 3px #000;
    line-height: 1.2; white-space: nowrap;
    transition: color 0.3s;
}

.building-block.active .building-label { 
    color: #ffffff !important; 
}

.detail-panel {
    position: absolute;
    left: 0; right: 0;
    background: rgba(10, 10, 10, 0.98);
    padding: 12px;
    max-height: 65%; 
    overflow-y: auto;
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 150;
    border-left: 2px solid var(--term-border);
    border-right: 2px solid var(--term-border);
}

/* 底部面板樣式 */
.detail-panel.bottom-panel {
    bottom: 0;
    top: auto;
    border-top: 2px solid var(--term-border);
    border-bottom: none;
    transform: translateY(100%);
}
.detail-panel.bottom-panel.active { 
    transform: translateY(0); 
}

/* 頂部面板樣式 */
.detail-panel.top-panel {
    top: 0;
    bottom: auto;
    border-bottom: 2px solid var(--term-border);
    border-top: none;
    transform: translateY(-100%);
}
.detail-panel.top-panel.active { 
    transform: translateY(0); 
}

.detail-panel::-webkit-scrollbar { 
    width: 4px; 
}

.detail-panel::-webkit-scrollbar-thumb { 
    background: #444; 
    border-radius: 2px; 
}

.detail-title {
    font-size: 13px; font-weight: bold;
    margin-bottom: 8px; padding-bottom: 5px;
    border-bottom: 1px solid #333;
}

.detail-content { 
    font-size: 9px; 
    line-height: 1.6; 
    color: #999; 
}

.detail-content p { 
    margin: 5px 0; 
}

.detail-content .highlight { 
    color: var(--color-highlight); 
    font-weight: bold; 
}

.further-info-btn {
    margin-top: 10px; padding: 6px 12px;
    background: rgba(212, 160, 23, 0.1); 
    border: 1px solid var(--color-highlight);
    color: var(--color-highlight); 
    font-family: 'Share Tech Mono';
    font-size: 9px; 
    cursor: pointer; 
    border-radius: 3px;
    transition: all 0.2s; 
    width: 100%;
}

.further-info-btn:hover { 
    background: rgba(212, 160, 23, 0.2); 
}

.close-btn {
    position: absolute;
    top: 10px; right: 10px;
    background: none; 
    border: none;
    color: #888;
    padding: 4px 10px; 
    font-family: 'Share Tech Mono';
    font-size: 10px; 
    cursor: pointer; 
    transition: all 0.2s; 
    z-index: 10;
}

.close-btn:hover { 
    color: var(--color-highlight); 
}

.status-bar {
    padding: 8px 10px; 
    font-size: 9px; 
    color: #555;
    display: flex; 
    justify-content: flex-end;
    border-top: 1px solid #222; 
    margin-top: 8px;
    position: relative; 
    z-index: 100;
}
</style>
</head>
<body>

<div class="map-terminal">
    <div class="ticker-header">
        <div class="ticker-wrapper" id="tickerWrapper"></div>
    </div>
    <div class="map-container" id="mapContainer">
        <div class="city-canvas" id="cityCanvas">
          <div class="grid-layer" id="gridLayer"></div>
          
          <div class="meridian-line named" data-district="meridian-avenue" data-zone="meridian">
          <div class="meridian-line-visual"></div>
          </div>
          
          <!-- ========== 上城區 ========== -->
          <div class="building-block upper named" style="top: 2%; left: 70%; width: 26%; height: 11%; transform: rotate(-1deg);" data-district="north-relfers" data-zone="upper">
          <div class="building-label" style="color: var(--color-upper);">NORTH RELFERS</div>
          </div>
          
          <div class="building-block upper named" style="top: 4%; left: 6%; width: 24%; height: 13%; transform: rotate(2deg);" data-district="west-isgrove" data-zone="upper">
          <div class="building-label" style="color: var(--color-upper);">WEST<br>ISGROVE</div>
          </div>
          
          <!-- 公園：樣式恢復 -->
          <div class="building-block park named" style="top: 17%; left: 33%; width: 28%; height: 12%; transform: rotate(-2deg); clip-path: polygon(5% 0%, 95% 5%, 100% 40%, 92% 100%, 8% 95%, 0% 35%);" data-district="isgrovefield" data-zone="upper">
          <div class="building-label" style="color: #c0dec0;">ISGROVEFIELD<br>PARK</div>
          </div>
          
          <div class="building-block upper named" style="top: 14%; left: 68%; width: 29%; height: 11%; transform: rotate(1deg);" data-district="east-isgrove" data-zone="upper">
          <div class="building-label" style="color: var(--color-upper);">EAST ISGROVE</div>
          </div>
          
          <div class="building-block upper unnamed" style="top: 24%; left: 70%; width: 14%; height: 7%; transform: rotate(-2deg);"></div>
          
          <div class="building-block upper named" style="top: 21%; left: 4%; width: 26%; height: 13%; transform: rotate(-1deg);" data-district="by-siglos" data-zone="upper">
          <div class="building-label" style="color: var(--color-upper);">BY-SIGLOS</div>
          </div>
          
          <div class="building-block upper named" style="top: 28%; left: 66%; width: 30%; height: 13%; transform: rotate(2deg);" data-district="trajectory" data-zone="upper">
          <div class="building-label" style="color: var(--color-upper);">TRAJECTORY END</div>
          </div>
          
          <div class="building-block upper named" style="top: 33%; left: 32%; width: 30%; height: 11%; transform: rotate(-2deg);" data-district="newlimited" data-zone="upper">
          <div class="building-label" style="color: var(--color-upper);">NEWLIMITED<br>DISTRICT</div>
          </div>
          
          <div class="building-block upper unnamed" style="top: 8%; left: 34%; width: 14%; height: 6%; transform: rotate(-2deg);"></div>
          <div class="building-block upper unnamed" style="top: 10%; left: 50%; width: 12%; height: 5%; transform: rotate(3deg);"></div>
          <div class="building-block upper unnamed" style="top: 19%; left: 9%; width: 10%; height: 5%; transform: rotate(5deg);"></div>
          <div class="building-block upper unnamed" style="top: 36%; left: 5%; width: 15%; height: 6%; transform: rotate(-3deg);"></div>
          <div class="building-block upper unnamed" style="top: 43%; left: 80%; width: 12%; height: 4%; transform: rotate(2deg);"></div>
          
          <!-- ========== 下城區 ========== -->
          
          <div class="building-block lower named" style="top: 82%; left: 4%; width: 19%; height: 11%; transform: rotate(-1deg);" data-district="dock-22" data-zone="lower">
          <div class="building-label" style="color: var(--color-lower);">DOCK 22</div>
          </div>
          
          <div class="building-block lower named" style="top: 68%; left: 3%; width: 15%; height: 10%; transform: rotate(2deg);" data-district="district-7" data-zone="lower">
          <div class="building-label" style="color: var(--color-lower);">DISTRICT 7<br><span style="font-size:6px;"><span></div>
          </div>
          
          <div class="building-block lower named" style="top: 59%; left: 23%; width: 13%; height: 9%; transform: rotate(1deg);" data-district="district-1" data-zone="lower">
          <div class="building-label" style="color: var(--color-lower);">D-1</div>
          </div>
          
          <div class="building-block lower named" style="top: 56%; left: 39%; width: 14%; height: 12%; transform: rotate(-1deg);" data-district="district-2" data-zone="lower">
          <div class="building-label" style="color: var(--color-lower);">D-2</div>
          </div>
          
          <!-- D-4 和 D-5 位置交換 -->
          <div class="building-block lower named" style="top: 69%; left: 34%; width: 12%; height: 10%; transform: rotate(1deg);" data-district="district-4" data-zone="lower">
          <div class="building-label" style="color: var(--color-lower);">D-4</div>
          </div>
          
          <div class="building-block lower named" style="top: 70%; left: 20%; width: 14%; height: 12%; transform: rotate(-2deg);" data-district="district-5" data-zone="lower">
          <div class="building-label" style="color: var(--color-lower);">D-5</div>
          </div>

          
          <div class="building-block lower named" style="top: 83%; left: 26%; width: 12%; height: 10%; transform: rotate(2deg);" data-district="district-8" data-zone="lower">
          <div class="building-label" style="color: var(--color-lower);">D-8</div>
          </div>
          
          <div class="building-block lower named" style="top: 84%; left: 40%; width: 11%; height: 9%; transform: rotate(-1deg);" data-district="district-9" data-zone="lower">
          <div class="building-label" style="color: var(--color-lower);">D-9</div>
          </div>
          
          <div class="building-block lower named" style="top: 85%; left: 54%; width: 26%; height: 7%; transform: rotate(-1deg);" data-district="district-10" data-zone="lower">
          <div class="building-label" style="color: var(--color-lower);">D-10</div>
          </div>
          
          <div class="building-block lower named" style="top: 57%; left: 84%; width: 13%; height: 10%; transform: rotate(-3deg);" data-district="district-11" data-zone="lower">
          <div class="building-label" style="color: var(--color-lower);">D-11</div>
          </div>
          
          <div class="building-block lower named" style="top: 70%; left: 86%; width: 11%; height: 12%; transform: rotate(4deg);" data-district="district-12" data-zone="lower">
          <div class="building-label" style="color: var(--color-lower);">D-12</div>
          </div>
          
          <div class="building-block industrial named" style="top: 58%; left: 56%; width: 9%; height: 18%; transform: rotate(1deg);" data-district="industrial-3" data-zone="lower">
          <div class="building-label" style="color: var(--color-industrial); font-size:6px;">IND.<br>PREC.<br>3</div>
          </div>
          
          <div class="building-block industrial named" style="top: 75%; left: 49%; width: 10%; height: 13%; transform: rotate(-3deg);" data-district="industrial-5" data-zone="lower">
          <div class="building-label" style="color: var(--color-industrial); font-size:6px;">IND.<br>PREC.<br>5</div>
          </div>
          
          <div class="building-block lower named" style="top: 57%; left: 68%; width: 14%; height: 10%; transform: rotate(-1deg);" data-district="dock-19" data-zone="lower">
          <div class="building-label" style="color: var(--color-lower);">DOCK<br>19</div>
          </div>
          
          <div class="building-block lower named" style="top: 78%; left: 69%; width: 13%; height: 9%; transform: rotate(-1deg);" data-district="dock-23" data-zone="lower">
          <div class="building-label" style="color: var(--color-lower);">DOCK<br>23</div>
          </div>
          
          <div class="building-block lower unnamed" style="top: 73%; left: 64%; width: 8%; height: 6%; transform: rotate(3deg);"></div>
          
          <div class="building-block lower named" style="top: 89%; left: 82%; width: 14%; height: 7%; transform: rotate(1deg);" data-district="dock-25" data-zone="lower">
          <div class="building-label" style="color: var(--color-lower);">DOCK 25</div>
          </div>
          
          <div class="building-block lower unnamed" style="top: 57%; left: 4%; width: 16%; height: 6%; transform: rotate(4deg);"></div>
          <div class="building-block lower unnamed" style="top: 77%; left: 14%; width: 10%; height: 7%; transform: rotate(-2deg); background: linear-gradient(135deg, rgba(163, 22, 33, 0.15), rgba(163, 22, 33, 0.05)); border-color: var(--color-lower);"></div>
          <div class="building-block lower unnamed" style="top: 65%; left: 48%; width: 7%; height: 7%; transform: rotate(2deg);"></div>
          <div class="building-block lower unnamed" style="top: 79%; left: 91%; width: 6%; height: 7%; transform: rotate(-5deg);"></div>
          <div class="building-block lower unnamed" style="top: 91%; left: 30%; width: 9%; height: 5%; transform: rotate(3deg);"></div>

        </div>
        
        <div class="detail-panel bottom-panel" id="detailPanel">
          <button class="close-btn" id="closeBtn">X</button>
          <div class="detail-title" id="detailTitle"></div>
          <div class="detail-content" id="detailContent"></div>
          <button class="further-info-btn" id="furtherInfoBtn" style="display:none;"></button>
        </div>
    </div>
    <div class="status-bar"><span>CLICK TO EXPLORE</span></div>
</div>
<script>
const tickerMessages = [
  { text: "ONE CITY, TWO SIDES, ONE FUTURE : PROSPERITY ACROSS THE MERIDIAN.", type: "slogan" },
  { text: "SEE SOMETHING? SAY SOMETHING. TEXT TIP LINE: 771-000", type: "warning" },
  
  { text: "COLD IRON BEER — STRONG ENOUGH FOR A 14-HOUR SHIFT", type: "ad" },
  { text: "ENGINE GREASE LAGER — WORKER’S CHOICE SINCE 1988", type: "ad" },
  { text: "FREE LEGAL CONSULT — LABOR DISPUTE HOTLINE 660-221", type: "ad" },
  { text: "TONIGHT: STAR SINGER ARIA VOSS LIVE AT EAST ISGROVE HALL", type: "celebrity" },
  { text: "STREAMING PREMIERE — ‘GLASS CITY ELITE’ SEASON 3", type: "celebrity" },

  { text: "LOST ID CARD? REPLACE WITHIN 48 HOURS — SERVICE CODE 09", type: "warning" },
  { text: "DOCK 23 MORNING FISH MARKET — WHOLESALE OPEN 04:30", type: "ad" },
  { text: "DOCK 25 — AREA CLOSED AFTER DARK, ENTER AT YOUR OWN RISK", type: "warning" },

  { text: "UNDERGROUND FIGHT RUMORS INVESTIGATED — AUTHORITIES DENY ORGANIZED LEAGUE", type: "news" },
  { text: "ILLEGAL BOUT BETTING — REPORT VIA 771-332", type: "warning" },
  { text: "INDUSTRIAL ACCIDENT — 12 WORKERS MISSING AT PRECINCT 3", type: "news" },

  { text: "MISSING PERSON ALERT — FEMALE, 19, LAST SEEN NIGHT SHIFT", type: "warning" },
  { text: "ANONYMOUS CRIME TIPS — TEXT ONLY 771-000", type: "slogan" },

  { text: "BROKEN WHEEL AUTO — NO PAPERS, NO QUESTIONS — CALL 660-118", type: "ad" },
  { text: "CHEAP ROOMS WEEKLY RENT — HOT WATER SOMETIMES — 555-203", type: "ad" },

  { text: "LOWER DISTRICT CURFEW ENFORCED 22:00–06:00 — NO EXCEPTIONS", type: "warning" },
  { text: "CITY ALERT: WANTED — ARMED ASSAULT SUSPECT. TIP LINE 771-904", type: "warning" },

  { text: "NICOLETTE FOSTER SECURITY DIVISION EXPANDS PORT AUTHORITY CONTRACT", type: "news" },
  { text: "D'AUREVILLE FOUNDATION GALA ANNOUNCED — INVITATIONS SENT", type: "celebrity" },

  { text: "PROPERTY TAX INCENTIVES EXTENDED — UPPER DISTRICT ONLY", type: "news" },
  { text: "UPPER DISTRICT AIR QUALITY INDEX: EXCELLENT", type: "news" },
  { text: "LOWER DISTRICT AIR QUALITY INDEX: ACCEPTABLE", type: "news" },

  { text: "REMEMBER: COMPLIANCE IS FREEDOM", type: "slogan" }
];

const districtData = {
    'meridian-avenue': {
        title: 'MERIDIAN AVENUE',
        color: 'var(--color-meridian)',
        content: `<p><span class="highlight">官方定義</span>: "通往繁榮的康莊大道，連接城市的偉大動脈。"</p><p><span class="highlight">現實</span>: 一道看不見的牆。這條街本身並不起眼——老公寓、便利商店、隨時會換手的小餐館——但它是這座城市真正的分界線。警察巡邏在這裡變少，公共設施維修變慢，媒體的注意力開始轉移。</p><p><span class="highlight">象徵意義</span>: 上城區的人跨過這條街不是禁忌，只是沒必要。下城區的人站在這裡遙望，最好知道自己是來自哪一邊的。</p>`
    },
    'north-relfers': {
        title: 'NORTH RELFERS DISTRICT',
        color: 'var(--color-upper)',
        content: `<p><span class="highlight">位置</span>: 上城區最北端</p><p><span class="highlight">特徵</span>: 城市軍事與戰略科技集中區。整區建築高度統一、間距精確，道路筆直，幾乎沒有裝飾性設計。外牆多為低反射塗層與強化玻璃，窗戶比例低，入口深陷。門禁採用多重識別系統。</p><p><span class="highlight">氛圍</span>: 街道長時間維持著近乎異常的寂靜，車流被嚴格分流，行人數量低得像是被刻意控制過。很少有人停留或徘徊，經過的人也多半目的明確、步伐穩定。</p>`,
        furtherInfo: {
          title: 'MILITARY HEADQUARTERS',
          content: `<p><span class="highlight">Nicolette Foster 的辦公室及公寓位於此地。</span></p><p> 她是跨國軍火商，也是退役軍官出身。安保系統裡，她的身份屬於最高等級通行標記之一。大樓內幾乎所有人都知道她的名字，但沒人主動與她搭話。她住在頂層公寓，整面落地窗正對城市天際線。她經常站在窗前很久，不是為了放鬆，而是在觀察。城市對她而言從來不是風景，而是戰略版圖。</p>`
        }
    },
    'west-isgrove': {
        title: 'WEST ISGROVE DISTRICT',
        color: 'var(--color-upper)',
        content: `<p><span class="highlight">位置</span>: 上城區西北部</p><p><span class="highlight">特徵</span>: 高級住宅區與文化中心。街道保留石材路面與古樹列植，路燈為仿歷史造型，但內部是現代監控與感應裝置。博物館、圖書館、歌劇院集中分佈。</p>`,
        furtherInfo: {
          title: 'D\'AUREVILLE MANSION',
          content: `<p><span class="highlight">Laure D\'Aureville 的家族宅邸位於此地。</span></p><p>這是一座佔地廣闊的法式建築，有花園、噴泉、雕塑，但不對外開放。Laure 在這裡度過了她的童年，學會了如何微笑、如何傾聽、如何看穿人心。這座房子教會她的最重要的一課是——<span class="highlight">野心是必須的。</span></p>`
        }
    },
    'east-isgrove': {
        title: 'EAST ISGROVE DISTRICT',
        color: 'var(--color-upper)',
        content: `<p><span class="highlight">位置</span>: 上城區東部</p><p><span class="highlight">特徵</span>: 高端商業與購物區。整區玻璃幕牆密集，室內燈光設計高度一致，櫥窗更新速度極快，廣告投放帶有行為追蹤。高端餐飲採會員預約制，臨時訪客通常被婉拒。 </p><p><span class="highlight">秘密</span>:作為上城區的對外展示面，城市宣傳影片多在此取景。 </p>`
    },
    'trajectory': {
        title: 'TRAJECTORY END DISTRICT',
        color: 'var(--color-upper)',
        content: `<p><span class="highlight">位置</span>: 上城區東南部</p><p><span class="highlight">特徵</span>: 金融機構總部、證券演算法中心與投資基金辦公樓集中地。建築外觀高聳冷硬，大樓內部安靜卻高速運轉，真正的交易與決策在看不見的數據流裡完成。</p><p><span class="highlight">氛圍</span>: 人們步伐緊湊、目光向前。手機長時間貼在耳邊，對話裡充滿縮寫、代碼與專業術語，外人聽來像另一種語言。時間在這裡被精確切割，每一分鐘都被標上用途。</p>`
    },
    'newlimited': {
        title: 'NEWLIMITED ROAD DISTRICT',
        color: 'var(--color-upper)',
        content: `<p><span class="highlight">位置</span>: 上城區中部</p><p><span class="highlight">特徵</span>: 高端社交場所聚集地，上城區私密社交與權力交換場域。私人會所、俱樂部、賭場、酒吧、餐廳集中在此。入口低調但安保嚴格，外觀往往刻意設計成不起眼。</p><p><span class="highlight">秘密</span>:晚宴、酒會經常舉辦，但真正的交易發生在包廂與二層隔間，而非公共空間。監控存在，但只保護會員利益。</p>`,
        furtherInfo: {
          title: 'THE CLUB',
          content: `<p><span class="highlight">Laure D\'Aureville 是這裡的常客。</span></p><p>她喜歡這裡的氛圍——有界線、有規則、有控制。這裡的每個人都知道自己的位置，知道什麼該說、什麼不該說。這裡是她的遊樂場，也是她的戰場。一句閒談、一次停頓、一個眼神，都可能成為她判讀對方價值與弱點的線索。她在那裡周旋、引導、設局，把談話變成測試，把禮貌變成武器。</p>`
        }
    },
    'by-siglos': {
        title: 'BY-SIGLOS DISTRICT',
        color: 'var(--color-upper)',
        content: `<p><span class="highlight">位置</span>: 上城區西部</p><p><span class="highlight">特徵</span>: 藝術拍賣、收藏交易、概念畫廊區。白盒子展廳與私人拍賣樓交錯存在。展品標價與實際成交價差距極大，資產洗白行為常透過藝術品流通完成。</p>`
    },
    'isgrovefield': {
        title: 'ISGROVEFIELD PARK',
        color: 'var(--color-park)',
        content: `<p><span class="highlight">位置</span>: 上城區中心</p><p><span class="highlight">特徵</span>: 上城區的象徵，一座漂亮的公園。植栽按季節輪替，土壤與水質長期監測。隱藏式灌溉系統全天候運作。無流浪者停留點，長椅設計防躺臥。</p><p><span class="highlight">象徵意義</span>: 上城區的人喜歡來這裡，因為這裡能讓他們忘記城市的骯髒與醜惡。他們認為這裡是文明的象徵，是他們與下城區人不同的證明。</p>`
    },
   'district-7': {
    title: 'DISTRICT 7',
    color: 'var(--color-lower)',
    content: `<p><span class="highlight">位置</span>: 下城區西北部</p>
<p><span class="highlight">特徵</span>: 下城區西北舊住宅建築帶，彼此距離極近，從窗戶能直接看進對面屋內。晾衣繩橫跨街道。公共空間被私人化——樓下走廊會被住戶加門鎖起來。違章加建普遍，電線外露，管線老化。</p>
<p><span class="highlight">秘密</span>: 流浪動物經常出沒，似乎有被人為餵養的習慣。</p>`,
    furtherInfo: {
        title: 'DAWN\'S APARTMENT & WORKPLACE',
        content: `<p><span class="highlight">Dawn Winslet 居住與工作於此。</span></p>
<p><strong>住處：</strong>位於一棟破敗大樓的三樓，狹小、骯髒，只有一張床、一張桌子、一台電視。窗外正對著隔壁建築的牆面，幾乎沒有陽光。她把門鎖好、窗簾拉上，就能隔絕整個城市的噪音與目光。那不是家，只是一個暫時安全的封閉空間。</p>
<hr style="border:none;height:1px;background:#333;margin:8px 0;">
<p><strong>工作地點（Brad's Fixer修車廠）：</strong>這間修車廠老舊但可靠。鐵門常年半開，地面有洗不掉的油痕。老闆 Brad Tedd 體格高壯、話少、不多問客人來歷，只看車況說話。Dawn 在這裡當技工，處理從普通轎車到改裝引擎的各種問題。工資不高，但穩定——對她而言，穩定比體面重要。</p>`
    }
},
    'dock-22': {
        title: 'DOCK 22',
        color: 'var(--color-lower)',
        content: `<p><span class="highlight">位置</span>: 下城區西部港口</p><p><span class="highlight">特徵</span>: 大型吊機日夜運轉，集裝箱像積木一樣堆疊成牆。長途貨輪按時靠港，報關流程完整存在，但實際審查強度取決於貨主背景與關係網。有經驗的人都知道，只要文件做得漂亮，灰色貨物流進合法清單並不困難。這裡是制度與漏洞並存的地方。</p>`
    },
    'dock-19': {
        title: 'DOCK 19',
        color: 'var(--color-lower)',
        content: `<p><span class="highlight">位置</span>: 下城區東部港口</p><p><span class="highlight">特徵</span>: 城市內陸大型貨倉與分流轉運節點，名稱沿用舊港口編碼，實際已不臨海。由多棟封閉倉儲樓、鐵軌支線與重型卡車裝卸場構成。官方用途是「多式聯運中繼站」，但貨物流向透明度極低。夜間裝卸頻率遠高於白天，貨櫃標籤經常被二次覆蓋。部分倉庫採私人承包安保，執勤人員沒有制服標誌。 </p>`,
        furtherInfo: {
          title: 'NICOLETTE\'S INFLUENCE',
          content: `<p><span class="highlight">Nicolette Foster 的勢力延伸至此。</span></p><p> 這裡是她軍火貿易鏈中的關鍵轉運節點。貨物在此重新編碼、拆單、換標，再流向不同買家。她幾乎不會親自現身，但她的授權識別碼能讓貨櫃一路放行。只要系統裡出現那串代碼，檢查流程就會自動縮短——沒人願意多問一句。</p>`
        }
    },
    'industrial-3': {
        title: 'THIRD INDUSTRIAL PRECINCT',
        color: 'var(--color-industrial)',
        content: `<p><span class="highlight">位置</span>: 下城區中部</p><p><span class="highlight">特徵</span>: 維修、改裝、二級製造與拆解產業帶。車輛、機械、金屬加工密集。事故率高但申報率低。非法改裝與假零件市場活躍。</p><p><span class="highlight">秘密</span>:這裡的工資比其他地方高，所以總會有人願意來此工作。</p>`
    },
    'industrial-5': {
        title: 'FIFTH INDUSTRIAL PRECINCT',
        color: 'var(--color-industrial)',
        content: `<p><span class="highlight">位置</span>: 下城區南部</p><p><span class="highlight">特徵</span>: 原本的重工業核心地帶，鋼鐵、煉化與大型加工廠曾集中於此。產業外移與事故後，大約一半設施停擺。部分廠房封存，部分被低成本承包商接手維持最低限度運轉。區內可見廢棄冷卻塔、停轉的輸送帶與被封死的化學管線。仍在運作的工段通常圍上新鐵網與臨時控制室，像在廢墟中硬撐的孤島。 </p>`
    },
    'district-1': {
        title: 'DISTRICT 1',
        color: 'var(--color-lower)',
        content: `<p><span class="highlight">位置</span>: 下城區北部</p><p><span class="highlight">特徵</span>: 下城區最早期的居住區之一，公寓樓齡普遍超過四十年。住戶彼此認得臉，但很少真正來往。白天安靜，多數人外出打工；晚上燈一盞一盞亮起，能聽見電視聲透過薄牆傳出。</p>`
    },
    'district-2': {
        title: 'DISTRICT 2',
        color: 'var(--color-lower)',
        content: `<p><span class="highlight">位置</span>: 下城區北部</p><p><span class="highlight">特徵</span>: 由廉價商店、二手店、小吃檔與無牌酒吧組成的長條商業帶。招牌燈箱壞一半亮一半，廣告貼在舊廣告上。價格可以談，規則可以改。這裡的交易依靠口頭承諾與熟人介紹。現金流通遠高於電子支付。</p>`
    },
    'district-4': {
        title: 'DISTRICT 4',
        color: 'var(--color-lower)',
        content: `<p><span class="highlight">位置</span>: 下城區中部</p><p><span class="highlight">特徵</span>: 非法娛樂場所聚集地。妓院、賭場、地下酒吧集中在此。這裡的燈光昏暗，音響聲音大，空氣中瀰漫著煙霧。很多地方沒有名字，只有標誌或代號。這裡的規矩由場子自己定，糾紛通常不會報警，而是內部處理。</p>`
    },
    'district-5': {
        title: 'DISTRICT 5',
        color: 'var(--color-lower)',
        content: `<p><span class="highlight">位置</span>: 下城區中部</p><p><span class="highlight">特徵</span>: 非登記格鬥場聚集地。比賽場地多為改造倉庫或地下空間。賭盤由地方勢力控制。醫療處理多為非正式急救。這裡的觀眾大多是工人、失業者、移民，他們喜歡看男人、女人甚至孩子在擂台上打鬥。</p><p><span class="highlight">氛圍</span>: 牆上貼滿過期賽程單與手寫賠率。有些拳手在這裡出名，也在這裡消失。</p>`,
        furtherInfo: {
          title: 'DAWN\'S SECOND JOB',
          content: `<p><span class="highlight">Dawn Winslet 在這裡偶爾出現。</span></p><p>她是地下拳賽的拳手，站上擂台時，她沒有口號，也沒有表演動作。每一拳都很直接、很實用。她不追求名聲，也不相信什麼冠軍故事——對她來說，這只是一種換取現金的方式。打完、拿錢、離開。獎金用來付房租、填飽肚子、讓明天還能繼續活著。</p>`
        }
    },
    'district-8': {
        title: 'DISTRICT 8',
        color: 'var(--color-lower)',
        content: `<p><span class="highlight">位置</span>: 下城區南部</p><p><span class="highlight">特徵</span>: 黑市網絡中心。這裡的商品從來不登記，沒有固定攤位，只有固定時間與固定聯絡方式。你可以在這裡買到槍支、毒品、假證件、甚至人。</p><p><span class="highlight">秘密</span>: 這裡存在中介人階層，他們比貨物更重要。</p>`
    },
    'district-9': {
        title: 'DISTRICT 9',
        color: 'var(--color-lower)',
        content: `<p><span class="highlight">位置</span>: 下城區南部</p><p><span class="highlight">特徵</span>: 廢棄建築與高牆聚集區，牆面幾乎沒有空白處。圖層覆蓋圖層，標記覆蓋標記。塗鴉既是藝術，也是地盤宣告。夜間活動頻繁，有放風者、拍攝者與掩護者分工。清除隊與創作者之間像持續進行的戰爭。 </p><p><span class="highlight">秘密</span>: 塗鴉牆其實暗藏標記語言。某些重複出現的圖形不是藝術，而是訊號 。</p>`,
        furtherInfo: {
          title: 'SEHEE\'S TERRITORY',
          content: `<p><span class="highlight">Sehee An 主要在這裡活動。</span></p><p> 她是非法街頭行動的常客，也是塗鴉圈裡有名的問題人物。她喜歡把城市當作遊戲場——翻越封鎖線、躲避巡邏、故意在監控死角留下標記。牆面上那些帶有粉色變體符號的塗鴉，多半都出自她手。 </p>`
        }
    },
    'district-10': {
        title: 'DISTRICT 10',
        color: 'var(--color-lower)',
        content: `<p><span class="highlight">位置</span>: 下城區南部</p><p><span class="highlight">特徵</span>: 各類反抗組織、互助網絡與地下宣傳點集中。有印刷點、物資分發處、秘密會議室。牆上貼的是口號、行動日期與失蹤名單。這裡重視紀律與保密，外來者需要背書。警方會定期掃查，但很少一次抓到核心人物。組織結構像根系，不像樹。 </p>`
    },
    'district-11': {
        title: 'DISTRICT 11',
        color: 'var(--color-lower)',
        content: `<p><span class="highlight">位置</span>: 下城區東部</p><p><span class="highlight">特徵</span>: 移民聚居區。這裡的居民大多是外國人，語言混雜，招牌多語並列。餐館、小型宗教場所、匯款店集中。這裡的經濟依賴同鄉網絡運作。消息在社群內部流動快，對外流動慢。</p>`
    },
    'district-12': {
        title: 'DISTRICT 12',
        color: 'var(--color-lower)',
        content: `<p><span class="highlight">位置</span>: 下城區東部</p><p><span class="highlight">特徵</span>: 城市最低成本的生存區域。臨時住處、短租床位、廢屋佔住者混在一起。失蹤人口最後出現記錄常停在這區。救援與剝削都在這裡同時存在。</p>`,
        furtherInfo: {
          title: 'SEHEE\'S APARTMENT',
          content: `<p><span class="highlight">Sehee An 的據點位於此地。</span></p><p> 住處位於下城區一棟半廢棄商住混合樓的高層夾層空間，是她自己清出來的小據點。沒有正式水電與管線，沒有浴室，只放著幾個大型塑膠水桶用來簡單沖洗。電力來自偷接線與行動電源。室內只有折疊床墊、背包、噴漆工具箱與備用衣物。牆面貼著塗鴉草圖與路線記號。門口設了簡易機關防人闖入。她不常在這裡過夜——這裡只是藏身點，不是生活空間。</p>`
        }
    },
    'dock-23': {
        title: 'DOCK 23',
        color: 'var(--color-lower)',
        content: `<p><span class="highlight">位置</span>: 下城區東部港口</p><p><span class="highlight">特徵</span>: 冷鏈與內陸漁獲碼頭。白色保冷車一排排倒車進倉，壓縮機聲整晚不斷。地面長期潮濕，排水溝帶著鹽與血水混合的味道。進出人員多半穿防水外套與膠靴，驗貨與過秤區域有獨立照明，光線刺白，像手術室。</p>`
    },
    'dock-25': {
        title: 'DOCK 25',
        color: 'var(--color-lower)',
        content: `<p><span class="highlight">位置</span>: 下城區東南部港口</p><p><span class="highlight">特徵</span>: 廢棄港口。這裡的碼頭破敗，船隻鏽跡斑斑，貨櫃堆場荒蕪。沒有正式物流活動，只剩臨時用途：藏車、換車、卸非法貨、短暫會面。貨櫃被改造成臨時房間與工具間，門鎖種類各不相同。</p>`
    }
};

function initTicker() {
    const wrapper = document.getElementById('tickerWrapper');
    wrapper.innerHTML = tickerMessages.map(msg => `<span class="ticker-item ${msg.type}">${msg.text}</span>`).join('');
}

function drawGrid() {
    const gridLayer = document.getElementById('gridLayer');
    const width = gridLayer.clientWidth; 
    const height = gridLayer.clientHeight;
    
    // 上城區網格
    const upperVertical = [4, 13, 21, 28, 36, 45, 53, 62, 71, 80, 88, 96];
    upperVertical.forEach(x => {
        const line = document.createElement('div'); 
        line.className = 'grid-line'; 
        line.style.width = '1px'; 
        line.style.height = '45%'; 
        line.style.left = x + '%'; 
        line.style.top = '5%'; 
        line.style.transform = `skew(${Math.random() * 5 - 2.5}deg)`; 
        gridLayer.appendChild(line);
    });
    
    const upperHorizontal = [8, 16, 24, 32, 40, 48];
    upperHorizontal.forEach(y => {
        const line = document.createElement('div'); 
        line.className = 'grid-line'; 
        line.style.height = '1px'; 
        line.style.width = '90%'; 
        line.style.top = y + '%'; 
        line.style.left = '5%'; 
        line.style.transform = `skew(0deg, ${Math.random() * 4 - 2}deg)`; 
        gridLayer.appendChild(line);
    });
    
    // 下城區網格
    const lowerVertical = [3, 12, 19, 26, 33, 41, 49, 57, 66, 75, 83, 91];
    lowerVertical.forEach(x => {
        const line = document.createElement('div'); 
        line.className = 'grid-line'; 
        line.style.width = '1px'; 
        line.style.height = '42%'; 
        line.style.left = x + '%'; 
        line.style.top = '53%'; 
        line.style.transform = `skew(${Math.random() * 7 - 3.5}deg)`; 
        gridLayer.appendChild(line);
    });
    
    const lowerHorizontal = [56, 63, 71, 79, 87, 94];
    lowerHorizontal.forEach(y => {
        const line = document.createElement('div'); 
        line.className = 'grid-line'; 
        line.style.height = '1px'; 
        line.style.width = '90%'; 
        line.style.top = y + '%'; 
        line.style.left = '5%'; 
        line.style.transform = `skew(0deg, ${Math.random() * 5 - 2.5}deg)`; 
        gridLayer.appendChild(line);
    });
}

const detailPanel = document.getElementById('detailPanel');
const detailTitle = document.getElementById('detailTitle');
const detailContent = document.getElementById('detailContent');
const closeBtn = document.getElementById('closeBtn');
const furtherInfoBtn = document.getElementById('furtherInfoBtn');
const mapContainer = document.getElementById('mapContainer');

let currentDistrictKey = null;
let showingFurtherInfo = false;
let activeBlock = null;

function resetMapState() {
    detailPanel.classList.remove('active');
    mapContainer.classList.remove('focus-mode');
    document.querySelectorAll('.building-block.named').forEach(b => {
        b.classList.remove('active');
    });
    activeBlock = null;
    currentDistrictKey = null;
}

function setPanelPosition(zone) {
    if (zone === 'lower') {
        detailPanel.classList.remove('bottom-panel');
        detailPanel.classList.add('top-panel');
    } else {
        detailPanel.classList.remove('top-panel');
        detailPanel.classList.add('bottom-panel');
    }
}

document.querySelectorAll('.building-block.named').forEach(block => {
    block.addEventListener('click', function(e) {
        e.stopPropagation(); 
        const isActive = this.classList.contains('active');
        if (isActive) {
          resetMapState();
          return;
        }
        resetMapState();
        this.classList.add('active');
        activeBlock = this;
        mapContainer.classList.add('focus-mode');
        const zone = this.getAttribute('data-zone');
        setPanelPosition(zone);
        const key = this.getAttribute('data-district');
        if (key && districtData[key]) {
          const data = districtData[key];
          currentDistrictKey = key; 
          showingFurtherInfo = false;
          detailTitle.innerText = data.title; 
          detailTitle.style.color = data.color; 
          detailContent.innerHTML = data.content;
          if (data.furtherInfo) {
          furtherInfoBtn.style.display = 'block'; 
          furtherInfoBtn.innerText = '[ FURTHER INFORMATION ]';
          } else { 
          furtherInfoBtn.style.display = 'none'; 
          }
          void detailPanel.offsetWidth; 
          detailPanel.classList.add('active');
        }
    });
});

document.querySelector('.meridian-line').addEventListener('click', function(e) {
    e.stopPropagation();
    const key = this.getAttribute('data-district');
    const isActive = detailPanel.classList.contains('active') && currentDistrictKey === key;
    if (isActive) {
      resetMapState();
      return;
    }
    resetMapState();
    mapContainer.classList.add('focus-mode');
    setPanelPosition('meridian');
    if (key && districtData[key]) {
        const data = districtData[key];
        currentDistrictKey = key; 
        showingFurtherInfo = false;
        detailTitle.innerText = data.title; 
        detailTitle.style.color = data.color; 
        detailContent.innerHTML = data.content;
        furtherInfoBtn.style.display = 'none'; 
        detailPanel.classList.add('active');
    }
});

furtherInfoBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    const data = districtData[currentDistrictKey];
    if (data && data.furtherInfo) {
        if (!showingFurtherInfo) { 
          detailTitle.innerText = data.furtherInfo.title; 
          detailContent.innerHTML = data.furtherInfo.content; 
          this.innerText = '[ BACK TO MAIN INFO ]'; 
          showingFurtherInfo = true; 
        } else { 
          detailTitle.innerText = data.title; 
          detailContent.innerHTML = data.content; 
          this.innerText = '[ FURTHER INFORMATION ]'; 
          showingFurtherInfo = false; 
        }
    }
});

closeBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    resetMapState();
});

document.getElementById('cityCanvas').addEventListener('click', function(e) {
    if (e.target === this || e.target.classList.contains('grid-layer')) { 
        resetMapState();
    }
});

window.addEventListener('load', function() { 
    initTicker(); 
    drawGrid(); 
});

window.addEventListener('resize', function() {
    const gridLayer = document.getElementById('gridLayer'); 
    while (gridLayer.firstChild) { 
        gridLayer.removeChild(gridLayer.firstChild); 
    } 
    drawGrid(); 
});
</script>
</body>
</html>